<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="./bower_components/victor/build/victor.js"></script>
    <script>
        
        points=[];
        clickCounts = 0;

        function onmousedown(e)
        {
            var mycanvas=document.getElementById('mycanvas');
            ctx=mycanvas.getContext('2d');
            
            num = 5;
            
            clickCounts++;
            if(clickCounts<=num){//stop pushing point when reaching the input number
                if(clickCounts>=2/*&&clickCounts<=num*/){ 
                    ctx.lineTo(e.clientX, e.clientY);
                    ctx.stroke();
                }
                ctx.moveTo(e.clientX, e.clientY);


                //push points
                points.push(new Victor(e.clientX, e.clientY));
            
            }
            //debug
            //console.log("("+e.clientX+", "+e.clientY+")");
            //console.log(points);
            
            if(clickCounts == num)//5=5
                {
                    generateFractal(num-1);
                }
            else if(clickCounts==num+1)//6>5
                {
                    console.log("in else if, points.length: "+points.length);
                    console.log("points: "+points);
                    //generateFractal(num*num);
                    var i=0;
                    for(var j=0; j<num*num-1; j++)
                       {
                            //point1
                            addPoint1_x = (points[i+1].x-points[i].x)/3*1+points[i].x;
                            addPoint1_y = (points[i+1].y-points[i].y)/3*1+points[i].y;


                            //point2
                            addPoint2_x = (points[i+1].x-points[i].x)/3*2+points[i].x;
                            addPoint2_y = (points[i+1].y-points[i].y)/3*2+points[i].y;

                            //insert previous 2 points

                            points.splice(i+1, 0, new Victor(addPoint1_x, addPoint1_y));                          
                            points.splice(i+2, 0, new Victor(addPoint2_x, addPoint2_y));

                            /*console.log("addPoint1_x: "+addPoint1_x);
                            console.log("addPoint1_y: "+addPoint1_y);*/

                            //r = Math.sqrt((points[i+2].x-points[i+1].x)*(points[i+2].x-points[i+1].x)+(points[i+2].y-points[i+1].y)*(points[i+2].y-points[i+1].y))/2;

                            //point3
                            var s60 = Math.sin(60*Math.PI/180);
                            var c60 = Math.cos(60*Math.PI/180);
                            addPoint3_x = c60*(points[i+1].x-points[i+2].x)-s60*(points[i+1].y-points[i+2].y)+points[i+2].x;
                            addPoint3_y = s60*(points[i+1].x-points[i+2].x)+c60*(points[i+1].y-points[i+2].y)+points[i+2].y;                

                            //insert the 3rd point
                            points.splice(i+2, 0, new Victor(addPoint3_x, addPoint3_y));
                            i+=4;

                            //console.log(points);
                            //console.log("i=0, points.length: "+points.length);


                    }
                    
                    
                    ctx.clearRect(0, 0, mycanvas.width, mycanvas.height);
                    //connect lines
                    ctx.beginPath();
                    ctx.moveTo(points[0].x, points[0].y);
                    for(var i=0; i<points.length; i++){
                        ctx.lineTo(points[i].x, points[i].y);
                    }
                    ctx.stroke();
                }

            
            
            else if(clickCounts==num+2)//7
                {
                    generateFractal((num-1)*(num-1)*(num-1));
                }
            else if(clickCounts==num+3)//8
                {
                    generateFractal((num-1)*(num-1)*(num-1)*(num-1));
                }
       
        }
        var myload=function()
        {
            //var num = prompt("Please enter number of edge",10);
            mycanvas=document.getElementById('mycanvas');
            mycanvas.addEventListener('mousedown',onmousedown,true);
            
            //console.log("myload()");
        }
        
        var generateFractal = function(n){
            var i=0;
            //console.log("b4 for, points.length= "+points.length);
              //  for(var i=0; i<points.length; i+=4)
            console.log("num-1: "+Number(num-1));
                for(var j=0; j<n; j++)//j=number of sides
                   {

                        //point1
                        addPoint1_x = (points[i+1].x-points[i].x)/3*1+points[i].x;
                        addPoint1_y = (points[i+1].y-points[i].y)/3*1+points[i].y;


                        //point2
                        addPoint2_x = (points[i+1].x-points[i].x)/3*2+points[i].x;
                        addPoint2_y = (points[i+1].y-points[i].y)/3*2+points[i].y;

                        //insert previous 2 points

                        points.splice(i+1, 0, new Victor(addPoint1_x, addPoint1_y));                          
                        points.splice(i+2, 0, new Victor(addPoint2_x, addPoint2_y));

                        //console.log("addPoint1_x: "+addPoint1_x);
                        //console.log("addPoint1_y: "+addPoint1_y);

                        //r = Math.sqrt((points[i+2].x-points[i+1].x)*(points[i+2].x-points[i+1].x)+(points[i+2].y-points[i+1].y)*(points[i+2].y-points[i+1].y))/2;

                        //point3
                        var s60 = Math.sin(60*Math.PI/180);
                        var c60 = Math.cos(60*Math.PI/180);
                        addPoint3_x = c60*(points[i+1].x-points[i+2].x)-s60*(points[i+1].y-points[i+2].y)+points[i+2].x;
                        addPoint3_y = s60*(points[i+1].x-points[i+2].x)+c60*(points[i+1].y-points[i+2].y)+points[i+2].y;                

                        //insert the 3rd point
                        points.splice(i+2, 0, new Victor(addPoint3_x, addPoint3_y));
                        i+=4;

                        //console.log(points);
                        //console.log("i=0, points.length: "+points.length);


                    }
                    
                    
                    ctx.clearRect(0, 0, mycanvas.width, mycanvas.height);
                    //connect lines
                    ctx.beginPath();
                    ctx.moveTo(points[0].x, points[0].y);
                    for(var i=0; i<points.length; i++){
                        ctx.lineTo(points[i].x, points[i].y);
                    }
                    ctx.stroke();
            
            //console.log("points.length: "+points.length);
        };
    </script>
</head>
<body onload="myload()">
   <canvas id="mycanvas" width="1393" height="697" style="border:1px solid #000000"></canvas>
    
</body>
</html>